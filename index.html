<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BeatMaker App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f1115;
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }
        .neon-box {
            background: #1e2128;
            border: 1px solid #3f3f46;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
        }
        .neon-accent {
            color: #a855f7;
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }
        .btn-neon {
            background: linear-gradient(135deg, #a855f7 0%, #7e22ce 100%);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
            transition: all 0.2s;
        }
        .btn-neon:active {
            transform: scale(0.95);
            box-shadow: 0 0 5px rgba(168, 85, 247, 0.4);
        }
        .progress-bar-inner {
            background: #a855f7;
            box-shadow: 0 0 10px #a855f7;
            height: 100%;
            width: 100%;
            transition: width 0.1s linear;
        }
        .tab-btn { opacity: 0.5; transition: opacity 0.2s; border-bottom: 2px solid transparent; }
        .tab-btn.active { opacity: 1; border-bottom: 2px solid #a855f7; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col h-screen w-full p-4">

    <div class="flex justify-around mb-6 border-b border-gray-700 pb-2">
        <button id="tab-challenge" class="tab-btn active text-lg font-bold pb-1" onclick="switchTab('challenge')">üé≤ –ß–µ–ª–ª–µ–Ω–¥–∂</button>
        <button id="tab-freestyle" class="tab-btn text-lg font-bold pb-1" onclick="switchTab('freestyle')">üé§ –§—Ä–∏—Å—Ç–∞–π–ª</button>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê: –ß–ï–õ–õ–ï–ù–î–ñ -->
    <div id="content-challenge" class="tab-content active h-full flex flex-col">
        <div class="neon-box p-5 mb-6 flex-grow overflow-y-auto" id="challenge-card">
            <h2 class="text-xl font-bold mb-4 text-center text-gray-400">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ ‚¨áÔ∏è</h2>
        </div>
        
        <button onclick="generateChallenge()" class="btn-neon w-full py-4 rounded-xl text-white font-bold text-lg mb-2">
            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏—Ç
        </button>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ê: –§–†–ò–°–¢–ê–ô–õ -->
    <div id="content-freestyle" class="tab-content h-full flex flex-col items-center justify-center">
        <div id="freestyle-setup" class="w-full flex flex-col items-center">
            <p class="text-gray-400 text-center mb-6">–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä. –í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ –Ω–∞–∂–º–∏ —Å—Ç–∞—Ä—Ç!</p>
            
            <select id="speed-select" class="w-full bg-gray-800 border border-gray-600 text-white rounded-lg p-3 mb-6 outline-none focus:border-purple-500">
                <option value="3">–•–∞—Ä–¥–∫–æ—Ä (3 —Å–µ–∫)</option>
                <option value="5" selected>–ù–æ—Ä–º–∞–ª (5 —Å–µ–∫)</option>
                <option value="10">–ß–∏–ª–ª (10 —Å–µ–∫)</option>
            </select>

            <button onclick="startFreestyle()" class="btn-neon w-full py-4 rounded-xl text-white font-bold text-xl">
                –°–¢–ê–†–¢
            </button>
        </div>

        <div id="freestyle-active" class="w-full hidden flex flex-col items-center justify-center h-full pb-10">
            <div class="text-sm text-gray-400 mb-2" id="word-counter">–°–ª–æ–≤–æ 1/15</div>
            <div class="text-5xl font-black neon-accent mb-12 text-center break-words w-full" id="freestyle-word">–ì–û–¢–û–í?</div>
            
            <div class="w-full h-3 bg-gray-800 rounded-full overflow-hidden mb-6">
                <div id="timer-bar" class="progress-bar-inner"></div>
            </div>
            
            <button onclick="stopFreestyle()" class="text-red-400 border border-red-400 rounded-lg py-2 px-6 mt-4">–°—Ç–æ–ø</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ —Å–µ—Å—Å–∏—é
        let sessionChallenges = 0;
        let sessionWords = 0;
        let currentWordsInSession = 0;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ì–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –¢–µ–ª–µ–≥—Ä–∞–º–∞
        tg.MainButton.setParams({
            text: "üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ü–†–û–ì–†–ï–°–° –ò –í–´–ô–¢–ò",
            color: "#a855f7",
            text_color: "#ffffff"
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
        tg.MainButton.onClick(() => {
            const data = { challenges: sessionChallenges, words: sessionWords };
            tg.sendData(JSON.stringify(data)); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º Web App
        });

        function checkStats() {
            if (sessionChallenges > 0 || sessionWords > 0) {
                tg.MainButton.show();
            }
        }

        const GENRES = ["–ì—Ä–∞–π–º", "–ë–µ–π—Å–ª–∞–π–Ω", "UK Drill", "–ú—Ä–∞—á–Ω—ã–π –¢—Ä–∞–ø", "UK Garage", "Jungle", "Drum & Bass"];
        const MOODS = ["–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ", "–ú—Ä–∞—á–Ω–æ–µ", "–ö–∞—á–∞—é—â–µ–µ", "–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ", "–¢—Ä–µ–≤–æ–∂–Ω–æ–µ"];
        const INSTRUMENTS = ["–ú—Ä–∞—á–Ω–æ–µ –ø–∏–∞–Ω–∏–Ω–æ", "–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π 808-–π –±–∞—Å", "–ê–Ω–∞–ª–æ–≥–æ–≤—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä", "–í–æ–∫–∞–ª—å–Ω—ã–µ —á–æ–ø—ã", "–°—Ç—Ä–∞–Ω–Ω—ã–π FX –∑–≤—É–∫"];
        const CONDITIONS = [
            "–ò—Å–ø–æ–ª—å–∑—É–π —Å–µ–º–ø–ª –≤—ã—Å—Ç—Ä–µ–ª–∞", "–ü–µ—Ä–µ–≥—Ä—É–∑–∏ –±–∞—Å (Distortion) –¥–æ –ø—Ä–µ–¥–µ–ª–∞", 
            "–°–¥–µ–ª–∞–π –º–æ—â–Ω—ã–π –≥–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ —É–¥–∞—Ä–Ω—ã—Ö", "–°–¥–µ–ª–∞–π —è–º—É (breakdown) –≤–æ–æ–±—â–µ –±–µ–∑ —É–¥–∞—Ä–Ω—ã—Ö",
            "–°–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã —Ö—ç—Ç—ã –∏–≥—Ä–∞–ª–∏ –∑–∞–¥–æ–º –Ω–∞–ø–µ—Ä–µ–¥ (Reverse)", "–î–æ–±–∞–≤—å –∑–≤—É–∫ —Å–∏—Ä–µ–Ω—ã"
        ];
        const FREESTYLE_WORDS = [
            "–ë–∞—Å", "–°—Ç—É–¥–∏—è", "–î–µ–¥–ª–∞–π–Ω", "–¢–µ–Ω—å", "–≠–∫—Ä–∞–Ω", "–®—É–º", "–†–∏—Ç–º", "–ü—Ä–æ–≤–æ–¥", "–°–≤–µ—Ç", "–í–∏–∑—É–∞–ª", 
            "–ü—Ä–æ–µ–∫—Ç", "–•–æ–ª–æ–¥", "–°–∫–æ—Ä–æ—Å—Ç—å", "–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä", "–ú–∞—Ç—Ä–∏—Ü–∞", "–ö–æ–¥", "–°—Ç–∏–ª—å", "–ú–∏–∫—Ä–æ—Ñ–æ–Ω", "–ù–æ—á—å",
            "–ü—É–ª—å—Å", "–ì–ª–∏—Ç—á", "–ë–∏—Ç", "–≠—Ö–æ", "–¢—Ä–∞—Å—Å–∞", "–ü–µ–ø–µ–ª", "–§–ª–æ—É", "–¢–æ–ª–ø–∞", "–ö–æ–Ω–Ω–µ–∫—Ç", "–ù–µ–π—Ä–æ—Å–µ—Ç—å",
            "–°–µ–∫–≤–µ–Ω—Å–æ—Ä", "–ü–ª–∞–≥–∏–Ω", "–ú–∞—Å—Ç–µ—Ä–∏–Ω–≥", "–°–≤–µ–¥–µ–Ω–∏–µ", "–†–µ–≤–µ—Ä–±", "–î–∏–ª–µ–π", "–ú–µ—Ç—Ä–æ", "–ê–Ω–¥–µ–≥—Ä–∞—É–Ω–¥", "–ë–µ—Ç–æ–Ω"
        ];

        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
        function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`content-${tabId}`).classList.add('active');
            if(tabId === 'challenge') stopFreestyle();
        }

        function generateChallenge() {
            const bpm = getRandomInt(120, 160);
            const cond1 = getRandom(CONDITIONS);
            let cond2 = getRandom(CONDITIONS);
            while(cond1 === cond2) cond2 = getRandom(CONDITIONS);

            const html = `
                <div class="text-sm text-purple-400 font-bold tracking-widest uppercase mb-1">–ñ–∞–Ω—Ä</div>
                <div class="text-2xl font-bold mb-4">${getRandom(GENRES)}</div>
                <div class="flex justify-between mb-4">
                    <div>
                        <div class="text-xs text-gray-500 uppercase">–¢–µ–º–ø</div>
                        <div class="text-xl font-bold">${bpm} BPM</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-500 uppercase">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                        <div class="text-xl font-bold">${getRandom(MOODS)}</div>
                    </div>
                </div>
                <div class="text-sm text-purple-400 font-bold tracking-widest uppercase mb-1 mt-4">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</div>
                <div class="text-lg mb-4">${getRandom(INSTRUMENTS)}</div>
                <div class="text-sm text-purple-400 font-bold tracking-widest uppercase mb-1">–£—Å–ª–æ–≤–∏—è</div>
                <ul class="list-disc pl-5 text-gray-300">
                    <li class="mb-1">${cond1}</li>
                    <li>${cond2}</li>
                </ul>
            `;
            document.getElementById('challenge-card').innerHTML = html;
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            sessionChallenges++;
            checkStats();
        }

        let timerInterval;
        let wordInterval;
        let wordsLeft = 15;
        let currentSpeed = 5;

        function startFreestyle() {
            document.getElementById('freestyle-setup').classList.add('hidden');
            document.getElementById('freestyle-active').classList.remove('hidden');
            currentSpeed = parseInt(document.getElementById('speed-select').value);
            wordsLeft = 15;
            currentWordsInSession = 0;
            nextWord();
        }

        function nextWord() {
            if (wordsLeft <= 0) {
                sessionWords += currentWordsInSession;
                currentWordsInSession = 0;
                stopFreestyle();
                checkStats();
                tg.showAlert("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!");
                return;
            }

            document.getElementById('freestyle-word').innerText = getRandom(FREESTYLE_WORDS);
            document.getElementById('word-counter').innerText = `–°–ª–æ–≤–æ ${16 - wordsLeft}/15`;
            
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none';
            bar.style.width = '100%';
            
            setTimeout(() => {
                bar.style.transition = `width ${currentSpeed}s linear`;
                bar.style.width = '0%';
            }, 50);

            currentWordsInSession++;
            wordsLeft--;

            clearInterval(wordInterval);
            wordInterval = setTimeout(nextWord, currentSpeed * 1000);
        }

        function stopFreestyle() {
            clearInterval(wordInterval);
            if (currentWordsInSession > 0) {
                sessionWords += currentWordsInSession;
                currentWordsInSession = 0;
                checkStats();
            }
            document.getElementById('freestyle-setup').classList.remove('hidden');
            document.getElementById('freestyle-active').classList.add('hidden');
        }
    </script>
</body>
</html>
